{% extends "base.html" %}
{% block title %}Draw{% endblock %}
{% block head %}
  <h1 style="text-align: center; margin: 0;">Draw Pattern</h1>
{% endblock %}

{% block content %}
<!-- <div class="paint-clone">
<canvas id="canvas" width="800" height="600" align="center"></canvas>
    <div class="paint-tools">
        <input type="range" id="brush-size" min="1" max="50" value="5">
        <input type="color" id="color-picker">
        <button id="pen">Pen</button>
        <button id="eraser">Eraser</button>
        <button id="clear-canvas">Clear</button>
        <button id="save-draft">Save Draft</button>
    </div>width="800" height="600" 
</div> -->
<div class="paint-clone">
    <canvas id="canvas" style="border: 1px solid black;"></canvas><br>
    <div class="paint-tools">
        <input type="range" id="brush-size" min="1" max="50" value="5">
        <input type="color" id="color-picker" value="#000000">
        <button id="pen">Pen</button>
        <button id="eraser">Eraser</button>
        <button id="clear-canvas">Clear</button>
        <button id="save-draft">Save Draft</button>
    </div>
</div>






{% endblock %}
{% block javascript %}

    <script type="text/javascript">
        document.addEventListener("DOMContentLoaded", function() {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        let isDrawing = false;

        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mouseout", stopDrawing);

        function startDrawing(e) {
            isDrawing = true;
            draw(e);
        }

        function draw(e) {
            if (!isDrawing) return;

            ctx.lineWidth = document.getElementById("brush-size").value;
            ctx.lineCap = "round";
            ctx.strokeStyle = document.getElementById("color-picker").value;

            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            ctx.lineTo(x, y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function stopDrawing() {
            isDrawing = false;
            ctx.beginPath();
        }

        document.getElementById("clear-canvas").addEventListener("click", clearCanvas);

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        document.getElementById("save-draft").addEventListener("click", saveDraft);

        function saveDraft() {
            const canvasData = canvas.toDataURL(); // Get the data URL of the canvas
            const formData = new FormData();
            formData.append("template_data", canvasData);

            fetch("/save_canvas_template_draft", {
                method: "POST",
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                } else {
                    throw new Error("Network response was not ok.");
                }
            })
            .then(data => {
                console.log(data);
                alert("Draft saved successfully");
            })
            .catch(error => {
                console.error("Error saving draft:", error);
                alert("Error saving draft");
            });
        }
    });

        // document.addEventListener("DOMContentLoaded", function() {
        // const canvas = document.getElementById("canvas");
        // const ctx = canvas.getContext("2d");
        // let isDrawing = false;
        // let lastX = 0;
        // let lastY = 0;
        // let hue = 0;
        // let direction = true;

        // canvas.addEventListener("mousedown", startDrawing);
        // canvas.addEventListener("mousemove", draw);
        // canvas.addEventListener("mouseup", stopDrawing);
        // canvas.addEventListener("mouseout", stopDrawing);

        // function startDrawing(e) {
        //     isDrawing = true;
        //     [lastX, lastY] = [e.offsetX, e.offsetY];
        // }

        // function draw(e) {
        //     if (!isDrawing) return;
        //     ctx.strokeStyle = `hsl(${hue}, 100%, 50%)`;
        //     ctx.lineWidth = 5;
        //     ctx.lineJoin = "round";
        //     ctx.lineCap = "round";

        //     ctx.beginPath();
        //     ctx.moveTo(lastX, lastY);
        //     ctx.lineTo(e.offsetX, e.offsetY);
        //     ctx.stroke();

        //     [lastX, lastY] = [e.offsetX, e.offsetY];

        //     hue++;
        //     if (hue >= 360) {
        //         hue = 0;
        //     }

        //     if (ctx.lineWidth >= 100 || ctx.lineWidth <= 1) {
        //         direction = !direction;
        //     }

        //     if (direction) {
        //         ctx.lineWidth++;
        //     } else {
        //         ctx.lineWidth--;
        //     }
        // }

        // function stopDrawing() {
        //     isDrawing = false;
        // }

        // const colorPicker = document.getElementById("color");
        // colorPicker.addEventListener("change", changeColor);

        // function changeColor() {
        //     ctx.strokeStyle = colorPicker.value;
        // }

        // const clearButton = document.getElementById("clear");
        // clearButton.addEventListener("click", clearCanvas);

        // function clearCanvas() {
        //     ctx.clearRect(0, 0, canvas.width, canvas.height);
        // }

        // document.getElementById("save-draft").addEventListener("click", saveDraft);

        // function saveDraft() {
        //     const canvasData = canvas.toDataURL(); // Get the data URL of the canvas
        //     const formData = new FormData();
        //     formData.append("canvas_data", canvasData);

        //     fetch("/save_canvas_template_draft", {
        //         method: "POST",
        //         body: formData
        //     })
        //     .then(response => response.json())
        //     .then(data => {
        //         console.log(data);
        //         alert("Draft saved successfully");
        //     })
        //     .catch(error => {
        //         console.error("Error saving draft:", error);
        //         alert("Error saving draft");
        //     });
        // }
        // });

    </script>
{% endblock %}
